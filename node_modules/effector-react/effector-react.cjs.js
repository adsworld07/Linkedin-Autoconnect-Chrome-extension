function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t,r,n){let o=[effector.step.run({fn:e=>t(e)})];if(n&&o.unshift(n),r){let t=effector.createNode({node:o}),n=e.graphite.id,s=r.additionalLinks,u=s[n]||[];return s[n]=u,u.push(t),()=>{let e=u.indexOf(t);-1!==e&&u.splice(e,1),effector.clearNode(t)}}{let t=effector.createNode({node:o,parent:[e],family:{owners:e}});return()=>{effector.clearNode(t)}}}function r(e,t){return t.displayName=e,t}function n(e,r){effector.is.store(e)||v('expect useStore argument to be a store');let n=m.useCallback((n=>t(e,n,r)),[e,r]),o=m.useCallback((()=>h(e,r)),[e,r]);return d.useSyncExternalStore(n,o,o)}function o(e,r){let n=effector.is.unit(e),o={};n?o={unit:e}:'@@unitShape'in e?'function'==typeof e['@@unitShape']?o=e['@@unitShape']():v('expect @@unitShape to be a function'):o=e;let s=Array.isArray(o),u=m.useRef({stale:1,justSubscribed:0,scope:r}),[a,l,c]=m.useMemo((()=>{u.current.stale=1;let e=Array.isArray(o)?[]:{},t=[],n=[];for(let s in o){let u=o[s];effector.is.unit(u)||v('expect useUnit argument to be a unit'),effector.is.event(u)||effector.is.effect(u)?e[s]=r?effector.scopeBind(u,{scope:r}):u:(e[s]=null,t.push(s),n.push(u))}return[e,t,n]}),[u,r,...Object.keys(o),...Object.values(o)]),i=m.useRef({value:a,storeKeys:l}),f=m.useCallback((e=>{let n=u.current;n.justSubscribed=1;let o=()=>{n.stale||(n.stale=1,e())},s=effector.step.compute({priority:'sampler',batch:1}),a=c.map((e=>t(e,o,r,s)));return()=>{a.forEach((e=>e()))}}),[c,r,i,u]),p=m.useCallback((()=>{let e,t=i.current,o=u.current,f=0,p=t.value,d=t.storeKeys,y=r!==o.scope;if(o.stale||o.justSubscribed||y){f=!o.justSubscribed||y,e=s?[...a]:{...a},d.length!==l.length&&(f=1);for(let t=0;t<l.length;t++){let n=h(c[t],r),o=l[t];f||(f=d.includes(o)?p[o]!==n:1),e[o]=n}}return f&&(t.value=e),t.storeKeys=l,o.stale=0,o.justSubscribed=!f,o.scope=r,n?t.value.unit:t.value}),[f,c,r,i,u]);return d.useSyncExternalStore(f,p,p)}function s([e,r],n){let o,s,u,a,l=S;r?(o=r,u=e,a=[]):({fn:o,store:u,keys:a,defaultValue:s,updateFilter:l=S}=e),effector.is.store(u)||v('useStoreMap expects a store'),Array.isArray(a)||v('useStoreMap expects an array as keys'),'function'!=typeof o&&v('useStoreMap expects a function');let c=m.useCallback((e=>t(u,e,n)),[u,n]),i=m.useCallback((()=>h(u,n)),[u,n]),f=m.useRef(),p=m.useRef(),d=m.useRef(a);return y.useSyncExternalStoreWithSelector(c,i,i,(e=>{if(f.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let r=1;for(let n=0;n<e.length;n++)if(e[n]!==t[n]){r=0;break}return r})(d.current,a)){let t=o(e,a);void 0===t&&void 0!==s&&(t=s),f.current=e,d.current=a,void 0!==t&&(p.current=t)}return p.current}),((e,t)=>!l(t,e)))}function u(e,t={},r){let{open:n,close:s,set:u}=o({open:e.open,close:e.close,set:e.set},r),a=m.useMemo((()=>({open:n,close:s,set:u})),[e,n]),l=m.useRef({value:null,count:0});b((()=>(a.open(l.current.value),()=>a.close(l.current.value))),[a]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return 0;for(let n=0;n<r.length;n++){let o=r[n];if(e[o]!==t[o])return 0}return 1}return 0})(l.current.value,t)||(l.current.value=t,l.current.count+=1),b((()=>{a.set(l.current.value)}),[l.current.count])}function a(e){let t=m.useContext(x);return e&&!t&&v('No scope found, consider adding <Provider> to app root'),t}function l(e,t){return n(e,a(null==t?void 0:t.forceScope))}function c(e,t){function n(e){let r=m.useRef(e),n=l(o);b((()=>(u({props:r.current,state:o.getState()}),()=>{a({props:r.current,state:o.getState()})})),[]);let s=t(e,n);return r.current=e,s}let o;effector.is.store(e)?o=e:'object'==typeof e&&null!==e?o=effector.combine(e):v('shape should be a store or object with stores');let s='Unknown';o&&o.shortName&&(s=o.shortName);let u=effector.createEvent(),a=effector.createEvent();return n.mounted=u,n.unmounted=a,r(`${s}.View`,n)}function i(e,t){let r=t?e:e[0];var n;(e=>{if(!e)throw Error('expect first argument be an object')})(C(n=r)||(e=>'function'==typeof e)(n));let o=r.or,s=r.and;if(s){let r=t?s:s[0];if(C(r)&&'and'in r){let r=i(s,t);e=r[0],o={...o,...r[1]}}else e=s}return[e,o]}function f(e,t){let r=t&&C(n=t[0])&&(n.and||n.or)?t:[{and:t}];var n;let o,[[s,u],a]=i(r),l={},c={},f=a;var p;return'string'==typeof s?(c={name:s},C(p=u)&&'sid'in p||(l=u||{})):(e=>C(e)&&('domain'in e||'defaultState'in e||'name'in e))(s)&&(c=s,l=s.defaultState||{},o=s.domain),{hook:e,domain:o,defaultState:l,mainConfig:c,maybeConfig:f}}Object.defineProperty(exports,'__esModule',{value:1});var p=require('react'),effector=require('effector'),d=require('use-sync-external-store/shim/index.js'),y=require('use-sync-external-store/shim/with-selector.js'),m=e(p);let v=e=>{throw Error(e)},b='undefined'!=typeof window?m.useLayoutEffect:m.useEffect;const h=(e,t)=>t?t.getState(e):e.getState(),S=(e,t)=>e!==t,x=m.createContext(null);let{Provider:k}=x,g=e=>console.error(`${e} is deprecated`),j=e=>t=>{let n=e;return'function'!=typeof e&&(n=t,t=e),r(`Connect(${n.displayName||n.name||'Unknown'})`,(e=>m.createElement(n,{...e,...l(t)})))},C=e=>'object'==typeof e&&null!==e,E=(e,t={})=>(C(e)&&(E(e.or,t),(e=>{for(let o in e)n=o,(e=>void 0===e)(r=e[o])||'or'===n||'and'===n||(t[n]=r);var r,n})(e),E(e.and,t)),t);exports.Provider=k,exports.connect=j,exports.createComponent=c,exports.createContextComponent=(e,t,n)=>(g('createContextComponent'),r(`${e.shortName||'Unknown'}.ContextComponent`,(r=>{let o=m.useContext(t),s=l(e);return n(r,s,o)}))),exports.createGate=(...e)=>(({domain:e,defaultState:t,hook:n,mainConfig:o,maybeConfig:s})=>{function u(e){return n(u,e),null}let a=E({or:s,and:o}),l=`${e?`${e.compositeName.fullName}/`:''}${a.name||'gate'}`,c=effector.createEvent({name:`${l}.set`,sid:a.sid?`${a.sid}|set`:void 0}),i=effector.createEvent({name:`${l}.open`,sid:a.sid?`${a.sid}|open`:void 0}),f=effector.createEvent({name:`${l}.close`,sid:a.sid?`${a.sid}|close`:void 0}),p=effector.createStore(Boolean(0),{name:`${l}.status`,serialize:'ignore'}).on(i,(()=>Boolean(1))).on(f,(()=>Boolean(0))),d=effector.createStore(t,{name:`${l}.state`,sid:a.sid}).on(c,((e,t)=>t)).on(i,((e,t)=>t)).reset(f);if(e){let{hooks:t}=e;effector.launch({target:[t.store,t.store,t.event,t.event,t.event],params:[p,d,i,f,c]})}return u.open=i,u.close=f,u.status=p,u.state=d,u.set=c,r(`Gate:${l}`,u)})(f(u,e)),exports.createReactState=(e,t)=>(g('createReactState'),j(t)(e)),exports.createStoreConsumer=e=>c(e,(({children:e},t)=>e(t))),exports.useEvent=(e,t)=>((e,t)=>{if(!t)return e;let r=effector.is.unit(e)||'object'!=typeof e?{event:e}:e;return m.useMemo((()=>{if(effector.is.unit(e))return effector.scopeBind(e,{scope:t});let r=Array.isArray(e)?[]:{};for(let n in e)r[n]=effector.scopeBind(e[n],{scope:t});return r}),[t,...Object.keys(r),...Object.values(r)])})(e,a(null==t?void 0:t.forceScope)),exports.useGate=(e,t={},r)=>u(e,t,a(null==r?void 0:r.forceScope)),exports.useList=(e,t,o)=>((e,t,o)=>{let u,a,l,c=[];'object'==typeof t&&null!==t?(t.keys&&(c=t.keys),({fn:u,getKey:a,placeholder:l}=t)):u=t,effector.is.store(e)||v('expect useList first argument to be a store'),'function'!=typeof u&&v("expect useList's renderItem to be a function"),Array.isArray(c)||v("expect useList's keys to be an array");let i=m.useMemo((()=>{let t=r(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:r,keys:n,keyVal:u,value:a}=t;if(f.current[1])return f.current[0](a,u);let l=s([{store:e,keys:[r,...n],fn:(e,t)=>e[t[0]]}],o);return f.current[0](l,r)}));return m.memo(t)}),[e,o,!!a]),f=m.useRef([u,a]);f.current=[u,a];let p=m.useMemo((()=>c),c);if(a){let t=n(e,o);return 0===t.length&&l?l:t.map((e=>{let t=f.current[1](e);return m.createElement(i,{keyVal:t,key:t,keys:p,value:e})}))}{let t=s([{store:e,keys:[e],fn:e=>e.length}],o);return 0===t&&l?l:Array.from({length:t},((e,t)=>m.createElement(i,{index:t,key:t,keys:p})))}})(e,t,a(null==o?void 0:o.forceScope)),exports.useStore=l,exports.useStoreMap=(e,t)=>s([e,t],a(null==e?void 0:e.forceScope)),exports.useUnit=(e,t)=>o(e,a(null==t?void 0:t.forceScope));
//# sourceMappingURL=effector-react.cjs.js.map
