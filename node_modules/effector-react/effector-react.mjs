function e(e,t,n,r){let o=[k.run({fn:e=>t(e)})];if(r&&o.unshift(r),n){let t=S({node:o}),r=e.graphite.id,u=n.additionalLinks,s=u[r]||[];return u[r]=s,s.push(t),()=>{let e=s.indexOf(t);-1!==e&&s.splice(e,1),g(t)}}{let t=S({node:o,parent:[e],family:{owners:e}});return()=>{g(t)}}}function t(e,t){return t.displayName=e,t}function n(t,n){x.store(t)||R('expect useStore argument to be a store');let r=v.useCallback((r=>e(t,r,n)),[t,n]),o=v.useCallback((()=>U(t,n)),[t,n]);return O(r,o,o)}function r(t,n){let r=x.unit(t),o={};r?o={unit:t}:'@@unitShape'in t?'function'==typeof t['@@unitShape']?o=t['@@unitShape']():R('expect @@unitShape to be a function'):o=t;let u=Array.isArray(o),s=v.useRef({stale:1,justSubscribed:0,scope:n}),[l,a,i]=v.useMemo((()=>{s.current.stale=1;let e=Array.isArray(o)?[]:{},t=[],r=[];for(let u in o){let s=o[u];x.unit(s)||R('expect useUnit argument to be a unit'),x.event(s)||x.effect(s)?e[u]=n?j(s,{scope:n}):s:(e[u]=null,t.push(u),r.push(s))}return[e,t,r]}),[s,n,...Object.keys(o),...Object.values(o)]),c=v.useRef({value:l,storeKeys:a}),f=v.useCallback((t=>{let r=s.current;r.justSubscribed=1;let o=()=>{r.stale||(r.stale=1,t())},u=k.compute({priority:'sampler',batch:1}),l=i.map((t=>e(t,o,n,u)));return()=>{l.forEach((e=>e()))}}),[i,n,c,s]),p=v.useCallback((()=>{let e,t=c.current,o=s.current,f=0,p=t.value,d=t.storeKeys,m=n!==o.scope;if(o.stale||o.justSubscribed||m){f=!o.justSubscribed||m,e=u?[...l]:{...l},d.length!==a.length&&(f=1);for(let t=0;t<a.length;t++){let r=U(i[t],n),o=a[t];f||(f=d.includes(o)?p[o]!==r:1),e[o]=r}}return f&&(t.value=e),t.storeKeys=a,o.stale=0,o.justSubscribed=!f,o.scope=n,r?t.value.unit:t.value}),[f,i,n,c,s]);return O(f,p,p)}function o([t,n],r){let o,u,s,l,a=K;n?(o=n,s=t,l=[]):({fn:o,store:s,keys:l,defaultValue:u,updateFilter:a=K}=t),x.store(s)||R('useStoreMap expects a store'),Array.isArray(l)||R('useStoreMap expects an array as keys'),'function'!=typeof o&&R('useStoreMap expects a function');let i=v.useCallback((t=>e(s,t,r)),[s,r]),c=v.useCallback((()=>U(s,r)),[s,r]),f=v.useRef(),p=v.useRef(),d=v.useRef(l);return L(i,c,c,(e=>{if(f.current!==e||!((e,t)=>{if(!e||!t||e.length!==t.length)return 0;let n=1;for(let r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n})(d.current,l)){let t=o(e,l);void 0===t&&void 0!==u&&(t=u),f.current=e,d.current=l,void 0!==t&&(p.current=t)}return p.current}),((e,t)=>!a(t,e)))}function u(e,t={},n){let{open:o,close:u,set:s}=r({open:e.open,close:e.close,set:e.set},n),l=v.useMemo((()=>({open:o,close:u,set:s})),[e,o]),a=v.useRef({value:null,count:0});M((()=>(l.open(a.current.value),()=>l.close(a.current.value))),[l]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(a.current.value,t)||(a.current.value=t,a.current.count+=1),M((()=>{l.set(a.current.value)}),[a.current.count])}function s(e){let t=v.useContext(V);return e&&!t&&R('No scope found, consider adding <Provider> to app root'),t}function l(e,t){return((e,t)=>{if(!t)return e;let n=x.unit(e)||'object'!=typeof e?{event:e}:e;return v.useMemo((()=>{if(x.unit(e))return j(e,{scope:t});let n=Array.isArray(e)?[]:{};for(let r in e)n[r]=j(e[r],{scope:t});return n}),[t,...Object.keys(n),...Object.values(n)])})(e,s(null==t?void 0:t.forceScope))}function a(e,t){return n(e,s(null==t?void 0:t.forceScope))}function i(e,t){return r(e,s(null==t?void 0:t.forceScope))}function c(e,t){return o([e,t],s(null==e?void 0:e.forceScope))}function f(e,r,u){return((e,r,u)=>{let s,l,a,i=[];'object'==typeof r&&null!==r?(r.keys&&(i=r.keys),({fn:s,getKey:l,placeholder:a}=r)):s=r,x.store(e)||R('expect useList first argument to be a store'),'function'!=typeof s&&R("expect useList's renderItem to be a function"),Array.isArray(i)||R("expect useList's keys to be an array");let c=v.useMemo((()=>{let n=t(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:n,keys:r,keyVal:s,value:l}=t;if(f.current[1])return f.current[0](l,s);let a=o([{store:e,keys:[n,...r],fn:(e,t)=>e[t[0]]}],u);return f.current[0](a,n)}));return v.memo(n)}),[e,u,!!l]),f=v.useRef([s,l]);f.current=[s,l];let p=v.useMemo((()=>i),i);if(l){let t=n(e,u);return 0===t.length&&a?a:t.map((e=>{let t=f.current[1](e);return v.createElement(c,{keyVal:t,key:t,keys:p,value:e})}))}{let t=o([{store:e,keys:[e],fn:e=>e.length}],u);return 0===t&&a?a:Array.from({length:t},((e,t)=>v.createElement(c,{index:t,key:t,keys:p})))}})(e,r,s(null==u?void 0:u.forceScope))}function p(e,t={},n){return u(e,t,s(null==n?void 0:n.forceScope))}function d(e,n){function r(e){let t=v.useRef(e),r=a(o);M((()=>(s({props:t.current,state:o.getState()}),()=>{l({props:t.current,state:o.getState()})})),[]);let u=n(e,r);return t.current=e,u}let o;x.store(e)?o=e:'object'==typeof e&&null!==e?o=C(e):R('shape should be a store or object with stores');let u='Unknown';o&&o.shortName&&(u=o.shortName);let s=$(),l=$();return r.mounted=s,r.unmounted=l,t(`${u}.View`,r)}function m(e){return d(e,(({children:e},t)=>e(t)))}function y(e,t){let n=t?e:e[0];var r;(e=>{if(!e)throw Error('expect first argument be an object')})(G(r=n)||(e=>'function'==typeof e)(r));let o=n.or,u=n.and;if(u){let n=t?u:u[0];if(G(n)&&'and'in n){let n=y(u,t);e=n[0],o={...o,...n[1]}}else e=u}return[e,o]}function b(e,t){let n=t&&G(r=t[0])&&(r.and||r.or)?t:[{and:t}];var r;let o,[[u,s],l]=y(n),a={},i={},c=l;var f;return'string'==typeof u?(i={name:u},G(f=s)&&'sid'in f||(a=s||{})):(e=>G(e)&&('domain'in e||'defaultState'in e||'name'in e))(u)&&(i=u,a=u.defaultState||{},o=u.domain),{hook:e,domain:o,defaultState:a,mainConfig:i,maybeConfig:c}}function h(...e){return(({domain:e,defaultState:n,hook:r,mainConfig:o,maybeConfig:u})=>{function s(e){return r(s,e),null}let l=W({or:u,and:o}),a=`${e?`${e.compositeName.fullName}/`:''}${l.name||'gate'}`,i=$({name:`${a}.set`,sid:l.sid?`${l.sid}|set`:void 0}),c=$({name:`${a}.open`,sid:l.sid?`${l.sid}|open`:void 0}),f=$({name:`${a}.close`,sid:l.sid?`${l.sid}|close`:void 0}),p=w(Boolean(0),{name:`${a}.status`,serialize:'ignore'}).on(c,(()=>Boolean(1))).on(f,(()=>Boolean(0))),d=w(n,{name:`${a}.state`,sid:l.sid}).on(i,((e,t)=>t)).on(c,((e,t)=>t)).reset(f);if(e){let{hooks:t}=e;A({target:[t.store,t.store,t.event,t.event,t.event],params:[p,d,c,f,i]})}return s.open=c,s.close=f,s.status=p,s.state=d,s.set=i,t(`Gate:${a}`,s)})(b(u,e))}import v from'react';import{step as k,createNode as S,clearNode as g,is as x,scopeBind as j,combine as C,createEvent as $,createStore as w,launch as A}from'effector/effector.mjs';import E from'use-sync-external-store/shim/with-selector.js';import N from'use-sync-external-store/shim/index.js';let R=e=>{throw Error(e)},M='undefined'!=typeof window?v.useLayoutEffect:v.useEffect;const{useSyncExternalStore:O}=N,{useSyncExternalStoreWithSelector:L}=E,U=(e,t)=>t?t.getState(e):e.getState(),K=(e,t)=>e!==t,V=v.createContext(null);let{Provider:B}=V,I=e=>console.error(`${e} is deprecated`),P=(e,n,r)=>(I('createContextComponent'),t(`${e.shortName||'Unknown'}.ContextComponent`,(t=>{let o=v.useContext(n),u=a(e);return r(t,u,o)}))),z=e=>n=>{let r=e;return'function'!=typeof e&&(r=n,n=e),t(`Connect(${r.displayName||r.name||'Unknown'})`,(e=>v.createElement(r,{...e,...a(n)})))},F=(e,t)=>(I('createReactState'),z(t)(e)),G=e=>'object'==typeof e&&null!==e,W=(e,t={})=>(G(e)&&(W(e.or,t),(e=>{for(let o in e)r=o,(e=>void 0===e)(n=e[o])||'or'===r||'and'===r||(t[r]=n);var n,r})(e),W(e.and,t)),t);export{B as Provider,z as connect,d as createComponent,P as createContextComponent,h as createGate,F as createReactState,m as createStoreConsumer,l as useEvent,p as useGate,f as useList,a as useStore,c as useStoreMap,i as useUnit};
//# sourceMappingURL=effector-react.mjs.map
